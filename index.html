<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CITADEL NEXUS</title>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <style>
        :root { --bg: #000; --panel: #111; --gold: #d4af37; --hp: #ff4444; --text: #eee; }
        * { box-sizing: border-box; }
        body { background: var(--bg); color: var(--text); font-family: 'Press Start 2P', cursive; margin: 0; font-size: 8px; overflow: hidden; height: 100vh; display: flex; flex-direction: column; }

        /* HEADER & STATS */
        header { background: var(--panel); padding: 15px; border-bottom: 2px solid var(--gold); text-align: center; }
        .stats-bar { display: flex; justify-content: space-around; background: #080808; padding: 10px; font-size: 6px; border-bottom: 1px solid #333; }
        .hp-box { width: 60px; height: 8px; background: #333; border: 1px solid #555; margin-top: 4px; }
        #hp-fill { height: 100%; background: var(--hp); width: 100%; transition: 0.5s; }

        /* NAVIGATION */
        nav { display: flex; background: var(--panel); }
        .tab-btn { flex: 1; padding: 15px 5px; border: none; background: none; color: #666; font-family: 'Press Start 2P'; font-size: 6px; cursor: pointer; border-bottom: 2px solid transparent; }
        .tab-btn.active { color: var(--gold); border-bottom: 2px solid var(--gold); background: #1a1a1a; }

        /* VIEWS */
        .view { display: none; flex: 1; padding: 20px; overflow-y: auto; }
        .view.active { display: block; }

        /* CARDS & INPUTS */
        .card { background: #181818; border: 1px solid #333; padding: 15px; margin-bottom: 15px; border-radius: 4px; }
        input { background: #000; border: 1px solid #444; color: #fff; padding: 12px; width: 100%; font-family: 'Press Start 2P'; font-size: 7px; margin-bottom: 10px; outline: none; }
        input:focus { border-color: var(--gold); }
        button { background: var(--gold); color: #000; border: none; padding: 12px; cursor: pointer; font-family: 'Press Start 2P'; font-size: 7px; width: 100%; font-weight: bold; }
        button:active { transform: scale(0.98); }

        /* SHOP ITEMS */
        .shop-item { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; padding-bottom: 10px; border-bottom: 1px solid #222; }
    </style>
</head>
<body>

<header>CITADEL SYSTEM v1.0</header>

<div class="stats-bar">
    <div>VIDA <div class="hp-box"><div id="hp-fill"></div></div></div>
    <div>ORO: <span id="gold-val" style="color:var(--gold)">0</span></div>
    <div>EQUIPO: <span id="wpn-val" style="color:var(--gold)">PUÑOS</span></div>
</div>

<nav>
    <button class="tab-btn active" onclick="showTab('misiones')">MISIONES</button>
    <button class="tab-btn" onclick="showTab('tienda')">TIENDA</button>
    <button class="tab-btn" onclick="showTab('notas')">NOTAS</button>
</nav>

<div id="misiones" class="view active">
    <div class="card">
        <input type="text" id="m-input" placeholder="¿Cuál es tu misión?">
        <button onclick="addMision()">FIJAR EN EL TABLÓN</button>
    </div>
    <div id="m-list"></div>
</div>

<div id="tienda" class="view">
    <div class="card">
        <div class="shop-item">
            <div>DAGA HIERRO<br><small style="color:var(--gold)">50 Oro</small></div>
            <button style="width:70px" onclick="buy('Daga Hierro', 50)">BUY</button>
        </div>
        <div class="shop-item">
            <div>ESPADA REAL<br><small style="color:var(--gold)">150 Oro</small></div>
            <button style="width:70px" onclick="buy('Espada Real', 150)">BUY</button>
        </div>
        <div class="shop-item">
            <div>HACHA ORCA<br><small style="color:var(--gold)">400 Oro</small></div>
            <button style="width:70px" onclick="buy('Hacha Orca', 400)">BUY</button>
        </div>
    </div>
</div>

<div id="notas" class="view">
    <input type="text" id="n-input" placeholder="Escribe un pensamiento...">
    <button onclick="addNota()">GUARDAR NOTA</button>
    <div id="n-list" style="margin-top:20px"></div>
</div>

<script>
    // --- LÓGICA DE DATOS ---
    let user = JSON.parse(localStorage.getItem('citadel_core')) || {
        hp: 100, gold: 0, wpn: "PUÑOS", missions: [], notes: []
    };

    function save() {
        localStorage.setItem('citadel_core', JSON.stringify(user));
        refresh();
    }

    // --- NAVEGACIÓN ---
    function showTab(id) {
        document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        event.currentTarget.classList.add('active');
    }

    // --- FUNCIONES MISIONES ---
    function addMision() {
        const inp = document.getElementById('m-input');
        if (inp.value.trim()) {
            user.missions.push({
                text: inp.value,
                time: Date.now(),
                done: false,
                fail: false
            });
            inp.value = "";
            save();
        }
    }

    function completeMision(index) {
        user.missions[index].done = true;
        user.gold += 50;
        save();
    }

    function deleteMision(index) {
        user.missions.splice(index, 1);
        save();
    }

    // --- FUNCIONES TIENDA & NOTAS ---
    function buy(name, price) {
        if (user.gold >= price) {
            user.gold -= price;
            user.wpn = name;
            save();
            alert("¡Equipado: " + name + "!");
        } else {
            alert("Oro insuficiente...");
        }
    }

    function addNota() {
        const inp = document.getElementById('n-input');
        if (inp.value.trim()) {
            user.notes.push(inp.value);
            inp.value = "";
            save();
        }
    }

    function deleteNota(index) {
        user.notes.splice(index, 1);
        save();
    }

    // --- REFRESCAR PANTALLA ---
    function refresh() {
        document.getElementById('hp-fill').style.width = user.hp + "%";
        document.getElementById('gold-val').innerText = user.gold;
        document.getElementById('wpn-val').innerText = user.wpn;

        // Lista misiones
        const ml = document.getElementById('m-list');
        ml.innerHTML = "";
        user.missions.forEach((m, i) => {
            const timePassed = Date.now() - m.time;
            const oneDay = 86400000;
            
            // Si pasó un día y no se hizo
            if (!m.done && !m.fail && timePassed > oneDay) {
                m.fail = true;
                user.hp = Math.max(0, user.hp - 20);
                localStorage.setItem('citadel_core', JSON.stringify(user));
            }

            ml.innerHTML += `
                <div class="card" style="border-left: 3px solid ${m.done ? '#0f0' : (m.fail ? '#f00' : '#555')}">
                    <div style="font-size:7px; margin-bottom:8px">${m.text}</div>
                    ${(!m.done && !m.fail) ? `<button onclick="completeMision(${i})">LOGRAR (+50g)</button>` : ''}
                    <div onclick="deleteMision(${i})" style="color:#444; margin-top:10px; font-size:5px; cursor:pointer">[ELIMINAR]</div>
                </div>`;
        });

        // Lista notas
        const nl = document.getElementById('n-list');
        nl.innerHTML = "";
        user.notes.forEach((n, i) => {
            nl.innerHTML += `
                <div class="card">
                    ${n}
                    <div onclick="deleteNota(${i})" style="color:red; text-align:right; margin-top:10px; font-size:5px; cursor:pointer">[BORRAR]</div>
                </div>`;
        });
    }

    // Iniciar
    refresh();
</script>

</body>
</html>
